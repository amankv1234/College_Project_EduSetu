<%- include("partials/navbar") %>

<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-900 text-white min-h-screen">

<div class="max-w-3xl mx-auto py-10">

  <h1 class="text-3xl font-bold mb-6 mt-8">⚡ Skill Evaluation Test</h1>

  <!-- Form -->
  <div class="bg-white/10 p-6 rounded-lg space-y-4">

    <input id="topic" 
           class="w-full p-3 rounded bg-white text-black" 
           placeholder="Enter topic (e.g. DSA, HTML, Java)" />

    <input id="count" type="number" 
           class="w-full p-3 rounded bg-white text-black" 
           placeholder="Number of questions" />

    <button id="generateBtn"
            class="w-full p-3 bg-indigo-600 rounded">
      Generate Test with AI
    </button>

  </div>

  <!-- Output -->
  <div id="testContainer" class="mt-8 space-y-4"></div>

</div>

<script>
document.getElementById("generateBtn").onclick = async () => {
  const topic = document.getElementById("topic").value.trim();
  const count = document.getElementById("count").value.trim();

  if (!topic || !count) {
    alert("Please enter topic and number of questions!");
    return;
  }

  // Show loading
  document.getElementById("testContainer").innerHTML =
    `<p class="text-yellow-300">⏳ Generating test… please wait</p>`;

  try {
    const response = await fetch("/api/generate-test", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ topic, count })
    });

    const data = await response.json();

    if (!data.questions) {
      document.getElementById("testContainer").innerHTML =
        `<p class="text-red-400">Error: ${data.error || "Something went wrong"}</p>`;
      return;
    }

    // Display questions
    let html = "";
    data.questions.forEach((q, i) => {
      html += `
      <div class="bg-white/10 p-4 rounded">
        <p class="font-semibold">${i + 1}. ${q.question}</p>
        <ul class="mt-2 space-y-1">
          ${q.options.map(op => `
            <li class="bg-white/20 p-2 rounded">${op}</li>
          `).join("")}
        </ul>
      </div>
      `;
    });

    document.getElementById("testContainer").innerHTML = html;

  } catch (err) {
    document.getElementById("testContainer").innerHTML =
      `<p class="text-red-400">Backend error. Check console.</p>`;
    console.log(err);
  }
};

document.getElementById("generateBtn").addEventListener("click", function () {
    const topic = document.getElementById("topic").value;
    const numQuestions = document.getElementById("count").value;

    fetch("/api/generate-test", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ topic, count })
    })
    .then(res => res.json())
    .then(data => {
        console.log(data);
        alert("Test Generated! Check console.");
    })
    .catch(err => console.error(err));
});


</script>

</body>
</html>
